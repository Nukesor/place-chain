<!DOCTYPE html>
<html>
<head>
	<title>place-chain</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
	<div class="jumbotron text-center">
		place - chain
	</div>
	<div class="container-fluid">
		<div class="row">
			<div class="col-6 col-sm-12 col-md-6 col-lg-6 col-xl-6">
				<div class="center-block text-center" style="width:400px;height:50px;">
					Click anywhere to fill the current Pixel with your current Color. Costs xxx Coins.
				</div>
				<canvas class="center-block" id="place_chain_canvas" width="400" height="400" style="border:1px solid #000000;"></canvas>
			</div>
			<div class="col-6 col-sm-12 col-md-6 col-lg-6 col-xl-6">
				<div class="center-block text-center" style="width:400px;height:50px;">
					Click to change your Color for xxx Coins.
				</div>
				<canvas class="center-block" id="place_chain_color_chooser" width="400" height="200" style="border:1px solid #000000;"></canvas>
				<div class="center-block text-center" style="width:400px;height:50px;">
					Your coins: <span id="place_chain_coins">0</span>
				</div>
			</div>
		</div>
	</div>
<script>
	var canvas = document.getElementById('place_chain_canvas');
	var canvascolor = document.getElementById('place_chain_color_chooser');
	var colorindex = 0;
	colors = [
		{r:   0, g:   0, b:   0},
		{r:   0, g:   0, b: 255},
		{r:   0, g: 255, b:   0},
		{r:   0, g: 255, b: 255},
		{r: 255, g:   0, b:   0},
		{r: 255, g:   0, b: 255},
		{r: 255, g: 255, b:   0},
		{r: 255, g: 255, b: 255},
		];
	function getMousePos(canvas, evt) {
		var rect = canvas.getBoundingClientRect();
		return {
			x: evt.clientX - rect.left,
			y: evt.clientY - rect.top
		};
	}
	function setPixel(canvas, x, y, color) {
		var context = canvas.getContext('2d');
		context.fillStyle = "rgb("+color.r+","+color.g+","+color.b+")";
		context.fillRect( x, y, 5, 5 );
	}
	function refreshColorChooser(canvas) {
		var context = canvas.getContext('2d');
		for (j = 0; j < 2; j++) {
			for (i = 0; i < 4; i++) {
				color=colors[i+j*4];
				if(i+j*4 == colorindex){
					context.fillStyle = "grey"
					context.fillRect(i*100,j*100,100,100);
					context.fillStyle = "rgb("+color.r+","+color.g+","+color.b+")";
					context.fillRect(i*100+5,j*100+5,90,90);
				}else{
					context.fillStyle = "rgb("+color.r+","+color.g+","+color.b+")";
					context.fillRect(i*100,j*100,100,100);
				}
			}
		}
	}
	canvas.addEventListener('mousemove', function(evt) {
			var mousePos = getMousePos(canvas, evt);
			var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
//TODO request to node : set Pixel (mousePos.x,mousePos.y) to color (colorindex)
			setPixel(canvas,mousePos.x,mousePos.y,colors[colorindex]);
		}, false);
	canvascolor.addEventListener('click', function(evt) {
			var mousePos = getMousePos(canvascolor, evt);
			colorindex = ((mousePos.x / 100) | 0) + ((mousePos.y / 100) | 0) * 4;
//TODO request to node : set my Color to (colorindex)
			refreshColorChooser(canvascolor);
		}, false);
	refreshColorChooser(canvascolor);
//TODO longpoll node : image changes
//TODO longpoll node : my coins change
//TODO longpoll node : my color change ? oder nicht ?
</script>
</body>
</html>
</body>
</html>
